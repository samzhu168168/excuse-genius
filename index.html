<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExcuseGenius - Your AI Alibi Co-pilot.</title>
    <meta name="description" content="Generate the perfect alibi with photo evidence in 5 seconds. Don't get fired, get creative. The ultimate AI excuse generator for work, deadlines, and social plans.">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 50% { opacity: .7; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        body { 
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; 
            color: #e2e8f0; 
            -webkit-tap-highlight-color: transparent;
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 20px 20px;
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
        .scenario-btn.active { 
            background-color: #4f46e5; 
            transform: scale(0.98);
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.5);
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .generate-btn-glow { box-shadow: 0 0 25px rgba(99, 102, 241, 0.6); animation: pulse 2s infinite; }
        .score-display {
            background: linear-gradient(145deg, #4f46e5, #a855f7);
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col items-center p-4">
    <div id="app" class="w-full max-w-md mx-auto flex flex-col gap-8 mt-4">
        <header class="text-center space-y-2">
            <h1 class="text-5xl font-extrabold tracking-tighter text-white">ExcuseGenius ğŸ¤–</h1>
            <p class="text-gray-400 text-lg">Your perfect alibi, instantly.</p>
        </header>

        <section id="scenario-selection" class="w-full">
            <div class="flex justify-between items-center mb-4">
                <p class="text-white font-semibold text-lg">1. Select your crisis:</p>
                <span class="text-xs text-green-400 bg-green-900/50 px-3 py-1 rounded-full flex items-center gap-1.5">
                    <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span>
                    <span id="active-users">1,204</span> users now
                </span>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <button class="scenario-btn p-4 bg-slate-800 hover:bg-slate-700 rounded-xl text-white font-medium transition-all duration-200 shadow-lg border border-slate-700" data-scenario="Late for Work">ğŸš— Late for Work</button>
                <button class="scenario-btn p-4 bg-slate-800 hover:bg-slate-700 rounded-xl text-white font-medium transition-all duration-200 shadow-lg border border-slate-700" data-scenario="Missed Deadline">â° Missed Deadline</button>
                <button class="scenario-btn p-4 bg-slate-800 hover:bg-slate-700 rounded-xl text-white font-medium transition-all duration-200 shadow-lg border border-slate-700" data-scenario="Need a Sick Day">ğŸ¤’ Sick Day</button>
                <button class="scenario-btn p-4 bg-slate-800 hover:bg-slate-700 rounded-xl text-white font-medium transition-all duration-200 shadow-lg border border-slate-700" data-scenario="Family Emergency">ğŸ  Family Emergency</button>
                <button class="scenario-btn p-4 bg-slate-800 hover:bg-slate-700 rounded-xl text-white font-medium transition-all duration-200 shadow-lg border border-slate-700" data-scenario="Tech/WFH Failure">ğŸ’» Tech Failure</button>
                <button class="scenario-btn p-4 bg-slate-800 hover:bg-slate-700 rounded-xl text-white font-medium transition-all duration-200 shadow-lg border border-slate-700" data-scenario="Bail on Plans">ğŸ‘‹ Bail on Plans</button>
            </div>
        </section>

        <section id="generate-section" class="w-full hidden">
            <p class="text-white font-semibold text-lg mb-3">2. Generate your freedom:</p>
            <div class="bg-indigo-900/30 border border-indigo-500/30 rounded-lg p-3 mb-4 flex items-center gap-3">
                <span class="text-xl">ğŸ”¥</span>
                <p class="text-sm text-indigo-200">Join <span class="font-bold text-white">14,392</span> users who got out of trouble this week.</p>
            </div>
            <button id="generate-btn" class="w-full bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 text-white font-bold py-4 px-4 rounded-xl text-xl transition-all flex items-center justify-center border-t border-indigo-400 generate-btn-glow">
                <span id="btn-text">Generate Perfect Alibi</span>
                <div id="loader" class="spinner hidden"></div>
                <span id="loader-text" class="hidden ml-3 text-base font-normal">Starting engine...</span>
            </button>
            <p id="credits-display" class="text-center text-xs text-gray-500 mt-2">Free uses left: <span id="uses-left">3</span></p>
        </section>

        <section id="results-section" class="w-full hidden">
            <div class="bg-slate-800/50 border border-slate-700 p-5 rounded-xl shadow-2xl backdrop-blur-sm">
                <div class="flex justify-between items-center mb-4">
                     <h3 class="font-bold text-white text-xl">Your Alibi Package</h3>
                     <div id="score-card" class="score-display text-white font-bold text-xs px-3 py-1.5 rounded-full">Believability: <span id="score-value">93%</span></div>
                </div>
                <div class="bg-slate-900/70 p-4 rounded-lg border-l-4 border-indigo-500 mb-4">
                    <p id="excuse-output" class="text-gray-100 text-lg leading-relaxed"></p>
                </div>
                <div class="relative group mb-4">
                    <img id="proof-image" src="" alt="Proof" class="rounded-lg w-full h-48 object-cover bg-slate-700">
                    <div class="absolute bottom-2 right-2 bg-black/60 px-2 py-1 rounded text-xs text-gray-300">AI-Generated Evidence</div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button id="copy-btn" class="bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-lg transition-colors">Copy Text</button>
                    <a id="download-btn" href="#" target="_blank" class="block bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-lg text-center transition-colors">View Proof</a>
                </div>
                <div class="mt-6 pt-4 border-t border-slate-700">
                    <div class="bg-gradient-to-r from-yellow-500/10 to-amber-500/10 border-2 border-yellow-400/30 rounded-lg p-4 text-center shadow-lg">
                        <p class="text-yellow-200 text-sm mb-2 font-bold">âœ¨ Want 3 more free uses?</p>
                        <button id="share-btn" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-2.5 rounded-lg shadow-lg transform active:scale-95 transition-all">
                            Share & Unlock (+3 Uses)
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div id="paywall-modal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden">
        <div class="bg-slate-800 border border-slate-700 rounded-2xl p-8 max-w-sm text-center shadow-2xl relative fade-in">
            <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 text-5xl">ğŸ‘‘</div>
            <h3 class="text-2xl font-bold text-white mb-2 mt-4">You're a natural!</h3>
            <p class="text-gray-400 mb-6">You've mastered the free tier. Join <span class="text-indigo-400 font-bold">5,000+ members</span> who never run out of excuses.</p>
            <div class="bg-indigo-900/40 p-4 rounded-lg mb-6 text-left">
                <ul class="space-y-2 text-gray-300">
                    <li class="flex items-center gap-2">âœ… Unlimited AI Generations</li>
                    <li class="flex items-center gap-2">âœ… Premium "Proof" Photos</li>
                    <li class="flex items-center gap-2">âœ… Priority Support</li>
                </ul>
            </div>
            <a href="https://excusegenius.lemonsqueezy.com/buy/YOUR_PRODUCT_ID" target="_blank" class="block w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 px-4 rounded-xl shadow-lg shadow-indigo-600/30 transition-all mb-2 text-lg">
                ğŸ”“ Unlock Pro Access ($4.99)
            </a>
            <p class="text-xs text-gray-500 mb-4">ğŸ”’ Secure payment via Lemon Squeezy â€¢ Cancel anytime</p>
            <button id="close-modal-btn" class="text-gray-500 hover:text-white text-sm">Maybe later</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // **å®‰å…¨:** API Key å·²ä»å‰ç«¯å®Œå…¨ç§»é™¤

            const MOCK_IMAGES = { 'Late for Work': ['https://images.unsplash.com/photo-1599507949390-d4642738435d?auto=format&fit=crop&w=800&q=80', 'https://images.unsplash.com/photo-1633613286991-611fe299c4be?auto=format&fit=crop&w=800&q=80'], 'Missed Deadline': ['https://images.unsplash.com/photo-1587614387466-0a72ca909e16?auto=format&fit=crop&w=800&q=80'], 'Need a Sick Day': ['https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?auto=format&fit=crop&w=800&q=80', 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&w=800&q=80'], 'Family Emergency': ['https://images.unsplash.com/photo-1585938389612-a552a28d6914?auto=format&fit=crop&w=800&q=80'], 'Tech/WFH Failure': ['https://images.unsplash.com/photo-1526649661456-89c7ed4d00b8?auto=format&fit=crop&w=800&q=80'], 'Bail on Plans': ['https://images.unsplash.com/photo-1517677130602-23a31293242a?auto=format&fit=crop&w=800&q=80'] };
            const LOADING_MSG = [ "Forging evidence...", "Aligning alibis...", "Consulting legal AI...", "Adding typo for realism...", "Hacking the mainframe...", "Reticulating splines..."];
            
            let useCount = parseInt(localStorage.getItem('excuseGeniusUseCount') || '0');
            const MAX_FREE = 3;
            let selectedScenario = null;

            const els = {
                activeUsers: document.getElementById('active-users'),
                usesLeftSpan: document.getElementById('uses-left'),
                btns: document.querySelectorAll('.scenario-btn'),
                genSection: document.getElementById('generate-section'),
                genBtn: document.getElementById('generate-btn'),
                results: document.getElementById('results-section'),
                output: document.getElementById('excuse-output'),
                img: document.getElementById('proof-image'),
                downloadBtn: document.getElementById('download-btn'),
                paywall: document.getElementById('paywall-modal'),
                closeModalBtn: document.getElementById('close-modal-btn'),
                shareBtn: document.getElementById('share-btn'),
                copyBtn: document.getElementById('copy-btn'),
                loader: document.getElementById('loader'),
                btnText: document.getElementById('btn-text'),
                loaderText: document.getElementById('loader-text'),
                scoreValue: document.getElementById('score-value')
            };

            function updateCredits() {
                const left = Math.max(0, MAX_FREE - useCount);
                els.usesLeftSpan.textContent = left;
            }

            // åŠ¨æ€ç”¨æˆ·æ•°ï¼Œå¢åŠ çœŸå®æ„Ÿ
            setInterval(() => {
                const current = parseInt(els.activeUsers.textContent);
                const change = Math.floor(Math.random() * 5) - 2;
                els.activeUsers.textContent = current + change;
            }, 2500);

            els.btns.forEach(btn => {
                btn.addEventListener('click', () => {
                    els.btns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    selectedScenario = btn.dataset.scenario;
                    els.genSection.classList.remove('hidden');
                    els.genSection.classList.add('fade-in');
                    els.results.classList.add('hidden');
                    setTimeout(() => els.genSection.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
                });
            });

            els.genBtn.addEventListener('click', async () => {
                if(useCount >= MAX_FREE) {
                    els.paywall.classList.remove('hidden');
                    els.paywall.classList.add('fade-in');
                    return;
                }
                setLoading(true);
                
                try {
                    const { text, believability } = await generateText(selectedScenario);
                    
                    const imgs = MOCK_IMAGES[selectedScenario] || MOCK_IMAGES['Late for Work'];
                    const randImg = imgs[Math.floor(Math.random() * imgs.length)];
                    
                    els.img.src = randImg;
                    els.downloadBtn.href = randImg;
                    els.output.textContent = text;
                    els.scoreValue.textContent = `${believability}%`;

                    useCount++;
                    localStorage.setItem('excuseGeniusUseCount', useCount);
                    updateCredits();

                    els.results.classList.remove('hidden');
                    els.results.classList.add('fade-in');
                    els.results.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } catch (e) {
                    alert('AI Overload: ' + e.message);
                } finally {
                    setLoading(false);
                }
            });

            // **æ ¸å¿ƒå‡½æ•°å˜æ›´**
            async function generateText(scenario) {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scenario })
                });

                if (!res.ok) {
                    const error = await res.json();
                    throw new Error(error.error || 'The server had an issue.');
                }
                return await res.json();
            }

            function setLoading(isLoading) {
                els.genBtn.disabled = isLoading;
                if (isLoading) {
                    els.btnText.classList.add('hidden');
                    els.loader.classList.remove('hidden');
                    els.loaderText.classList.remove('hidden');
                    let i = 0;
                    els.genBtn.dataset.interval = setInterval(() => {
                        els.loaderText.textContent = LOADING_MSG[i++ % LOADING_MSG.length];
                    }, 1500);
                } else {
                    els.btnText.classList.remove('hidden');
                    els.loader.classList.add('hidden');
                    els.loaderText.classList.add('hidden');
                    clearInterval(els.genBtn.dataset.interval);
                }
            }

            els.shareBtn.addEventListener('click', () => {
                const shareData = { title: 'ExcuseGenius', text: 'This AI just generated the perfect alibi for me! ğŸ”¥', url: window.location.href };
                if (navigator.share) {
                    navigator.share(shareData).then(() => {
                        unlockUses();
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href);
                    alert('Link copied! Share it to unlock more uses. +3 Uses Added!');
                    unlockUses();
                }
            });

            function unlockUses() {
                useCount = Math.max(0, useCount - 3);
                localStorage.setItem('excuseGeniusUseCount', useCount);
                updateCredits();
                els.paywall.classList.add('hidden');
            }

            els.closeModalBtn.addEventListener('click', () => els.paywall.classList.add('hidden'));

            els.copyBtn.addEventListener('click', (e) => {
                navigator.clipboard.writeText(els.output.textContent);
                e.target.textContent = 'Copied!';
                setTimeout(() => e.target.textContent = 'Copy Text', 2000);
            });
            
            updateCredits();
        });
    </script>
</body>
</html>

